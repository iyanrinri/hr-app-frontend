import{ax as D,j as T,a8 as v,X as j,a9 as O,ay as R,ac as I,aw as P,z as N}from"./CgE31YDV.js";import{i as L}from"./BJ2ClxiI.js";function M(e,i){if(typeof e!="string")throw new TypeError("argument str must be a string");const t={},o=i||{},a=o.decode||U;let r=0;for(;r<e.length;){const n=e.indexOf("=",r);if(n===-1)break;let c=e.indexOf(";",r);if(c===-1)c=e.length;else if(c<n){r=e.lastIndexOf(";",n-1)+1;continue}const s=e.slice(r,n).trim();if(o?.filter&&!o?.filter(s)){r=c+1;continue}if(t[s]===void 0){let u=e.slice(n+1,c).trim();u.codePointAt(0)===34&&(u=u.slice(1,-1)),t[s]=_(u,a)}r=c+1}return t}function U(e){return e.includes("%")?decodeURIComponent(e):e}function _(e,i){try{return i(e)}catch{return e}}const w=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function S(e,i,t){const o=t||{},a=o.encode||encodeURIComponent;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!w.test(e))throw new TypeError("argument name is invalid");const r=a(i);if(r&&!w.test(r))throw new TypeError("argument val is invalid");let n=e+"="+r;if(o.maxAge!==void 0&&o.maxAge!==null){const c=o.maxAge-0;if(Number.isNaN(c)||!Number.isFinite(c))throw new TypeError("option maxAge is invalid");n+="; Max-Age="+Math.floor(c)}if(o.domain){if(!w.test(o.domain))throw new TypeError("option domain is invalid");n+="; Domain="+o.domain}if(o.path){if(!w.test(o.path))throw new TypeError("option path is invalid");n+="; Path="+o.path}if(o.expires){if(!F(o.expires)||Number.isNaN(o.expires.valueOf()))throw new TypeError("option expires is invalid");n+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(n+="; HttpOnly"),o.secure&&(n+="; Secure"),o.priority)switch(typeof o.priority=="string"?o.priority.toLowerCase():o.priority){case"low":{n+="; Priority=Low";break}case"medium":{n+="; Priority=Medium";break}case"high":{n+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(o.sameSite)switch(typeof o.sameSite=="string"?o.sameSite.toLowerCase():o.sameSite){case!0:{n+="; SameSite=Strict";break}case"lax":{n+="; SameSite=Lax";break}case"strict":{n+="; SameSite=Strict";break}case"none":{n+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return o.partitioned&&(n+="; Partitioned"),n}function F(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function f(e){if(typeof e!="object")return e;var i,t,o=Object.prototype.toString.call(e);if(o==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){t=new e.constructor;for(i in e)e.hasOwnProperty(i)&&t[i]!==e[i]&&(t[i]=f(e[i]))}else{t={};for(i in e)i==="__proto__"?Object.defineProperty(t,i,{value:f(e[i]),configurable:!0,enumerable:!0,writable:!0}):t[i]=f(e[i])}return t}if(o==="[object Array]"){for(i=e.length,t=Array(i);i--;)t[i]=f(e[i]);return t}return o==="[object Set]"?(t=new Set,e.forEach(function(a){t.add(f(a))}),t):o==="[object Map]"?(t=new Map,e.forEach(function(a,r){t.set(f(r),f(a))}),t):o==="[object Date]"?new Date(+e):o==="[object RegExp]"?(t=new RegExp(e.source,e.flags),t.lastIndex=e.lastIndex,t):o==="[object DataView]"?new e.constructor(f(e.buffer)):o==="[object ArrayBuffer]"?e.slice(0):o.slice(-6)==="Array]"?new e.constructor(e):e}const z={path:"/",watch:!0,decode:e=>D(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))},y=globalThis.cookieStore;function E(e,i){const t={...z,...i};t.filter??=u=>u===e;const o=A(t)||{};let a;t.maxAge!==void 0?a=t.maxAge*1e3:t.expires&&(a=t.expires.getTime()-Date.now());const r=a!==void 0&&a<=0,n=r||o[e]===void 0||o[e]===null,c=f(r?void 0:o[e]??t.default?.()),s=a&&!r?V(c,a,t.watch&&t.watch!=="shallow"):T(c);{let u=null;try{!y&&typeof BroadcastChannel<"u"&&(u=new BroadcastChannel(`nuxt:cookies:${e}`))}catch{}const d=(l=!1)=>{!l&&(t.readonly||L(s.value,o[e]))||(H(e,s.value,t),o[e]=f(s.value),u?.postMessage({value:t.encode(s.value)}))},p=l=>{const h=l.refresh?A(t)?.[e]:t.decode(l.value);m=!0,s.value=h,o[e]=f(h),I(()=>{m=!1})};let m=!1;const b=!!O();if(b&&v(()=>{m=!0,d(),u?.close()}),y){const l=h=>{const k=h.changed.find(g=>g.name===e),x=h.deleted.find(g=>g.name===e);k&&p({value:k.value}),x&&p({value:null})};y.addEventListener("change",l),b&&v(()=>y.removeEventListener("change",l))}else u&&(u.onmessage=({data:l})=>p(l));t.watch&&j(s,()=>{m||d()},{deep:t.watch!=="shallow"}),n&&d(n)}return s}function A(e={}){return M(document.cookie,e)}function B(e,i,t={}){return i==null?S(e,i,{...t,maxAge:-1}):S(e,i,t)}function H(e,i,t={}){document.cookie=B(e,i,t)}const C=2147483647;function V(e,i,t){let o,a,r=0;const n=t?T(e):{value:e};return O()&&v(()=>{a?.(),clearTimeout(o)}),R((c,s)=>{t&&(a=j(n,s));function u(){r=0,clearTimeout(o);const d=i-r,p=d<C?d:C;o=setTimeout(()=>{if(r+=p,r<i)return u();n.value=void 0,s()},p)}return{get(){return c(),n.value},set(d){u(),n.value=d,s()}}})}const X=P("auth",()=>{const e=E("auth-token",{maxAge:604800,path:"/"}),i=E("auth-user",{maxAge:3600*24*7,path:"/"});function t(n,c){e.value=n,i.value=c}function o(){e.value=null,i.value=null}async function a(){if(e.value)try{const n=await $fetch("/api/auth/profile");n&&(i.value=n)}catch(n){console.error("Failed to fetch profile",n)}}const r=N(()=>!!e.value);return{token:e,user:i,setAuth:t,clearAuth:o,fetchProfile:a,isAuthenticated:r}});export{X as u};
