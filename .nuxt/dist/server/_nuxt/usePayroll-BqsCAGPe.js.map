{"version":3,"file":"usePayroll-BqsCAGPe.js","sources":["../../../../composables/usePayroll.ts"],"sourcesContent":["import type { \n    Payroll, \n    CreatePayrollRequest,\n    PayrollFilters,\n    PayrollListResponse,\n    ProcessPayrollRequest,\n    PayrollSummary,\n    BulkGeneratePayrollRequest,\n    BulkGeneratePayrollResponse \n} from '@/types/payroll'\n\nconst useTenantUrl = () => {\n    const route = useRoute()\n    const tenantSlug = route.params.tenant_slug as string\n    \n    return (path: string) => {\n      const cleanPath = path.startsWith('/') ? path : `/${path}`\n      return tenantSlug ? `/api/${tenantSlug}${cleanPath}` : `/api${cleanPath}`\n    }\n}\n\nexport const usePayrolls = (filters: MaybeRef<PayrollFilters> = {}) => {\n    const getUrl = useTenantUrl()\n\n    const queryParams = computed(() => {\n        const f = unref(filters)\n        return { ...f }\n    })\n\n    const { data, pending, error, refresh } = useFetch<PayrollListResponse>(() => getUrl('/payroll'), {\n        key: 'payrolls',\n        query: queryParams,\n        watch: [queryParams],\n        server: false\n    })\n\n    return {\n        data,\n        loading: pending,\n        error,\n        refresh\n    }\n}\n\nexport const useMyPayrolls = (filters: MaybeRef<Partial<PayrollFilters>> = {}) => {\n    const getUrl = useTenantUrl()\n\n    const queryParams = computed(() => {\n        const f = unref(filters)\n        return { ...f }\n    })\n\n    const { data, pending, error, refresh } = useFetch<PayrollListResponse>(() => getUrl('/payroll/my'), {\n        key: 'my-payrolls',\n        query: queryParams,\n        watch: [queryParams],\n        server: false\n    })\n\n    return {\n        data,\n        loading: pending,\n        error,\n        refresh\n    }\n}\n\nexport const usePayroll = (id: MaybeRef<string>) => {\n    const getUrl = useTenantUrl()\n\n    const { data, pending, error, refresh } = useFetch<Payroll>(() => getUrl(`/payroll/${unref(id)}`), {\n        key: `payroll-${unref(id)}`,\n        immediate: !!unref(id),\n        server: false\n    })\n\n    return {\n        data,\n        loading: pending,\n        error,\n        refresh\n    }\n}\n\nexport const usePayrollSummary = (employeeId?: MaybeRef<string>) => {\n    const getUrl = useTenantUrl()\n\n    const queryParams = computed(() => {\n        const eid = unref(employeeId)\n        return eid ? { employeeId: eid } : {}\n    })\n\n    const { data, pending, error, refresh } = useFetch<PayrollSummary>(() => getUrl('/payroll/summary'), {\n        key: `payroll-summary-${unref(employeeId) || 'all'}`,\n        query: queryParams,\n        watch: [queryParams],\n        server: false\n    })\n\n    return {\n        data,\n        loading: pending,\n        error,\n        refresh\n    }\n}\n\nexport const useCreatePayroll = () => {\n    const getUrl = useTenantUrl()\n    const loading = ref(false)\n\n    const mutate = async (payload: CreatePayrollRequest, options?: { onSuccess?: () => void, onError?: (error: any) => void }) => {\n        loading.value = true\n        try {\n            await $fetch(getUrl('/payroll'), {\n                method: 'POST',\n                body: payload\n            })\n            if (options?.onSuccess) options.onSuccess()\n        } catch (error) {\n            if (options?.onError) options.onError(error)\n            throw error\n        } finally {\n            loading.value = false\n        }\n    }\n\n    return {\n        mutate,\n        loading\n    }\n}\n\nexport const useProcessPayrolls = () => {\n    const getUrl = useTenantUrl()\n    const loading = ref(false)\n\n    const mutate = async (payload: ProcessPayrollRequest, options?: { onSuccess?: () => void, onError?: (error: any) => void }) => {\n        loading.value = true\n        try {\n            await $fetch(getUrl('/payroll/process'), {\n                method: 'PUT',\n                body: payload\n            })\n            if (options?.onSuccess) options.onSuccess()\n        } catch (error) {\n            if (options?.onError) options.onError(error)\n             throw error\n        } finally {\n            loading.value = false\n        }\n    }\n\n    return {\n        mutate,\n        loading\n    }\n}\n\nexport const useMarkPayrollPaid = () => {\n    const getUrl = useTenantUrl()\n    const loading = ref(false)\n\n    const mutate = async (id: string, options?: { onSuccess?: () => void, onError?: (error: any) => void }) => {\n        loading.value = true\n        try {\n            await $fetch(getUrl(`/payroll/${id}/mark-paid`), {\n                method: 'PUT'\n            })\n            if (options?.onSuccess) options.onSuccess()\n        } catch (error) {\n            if (options?.onError) options.onError(error)\n            throw error\n        } finally {\n            loading.value = false\n        }\n    }\n\n    return {\n        mutate,\n        loading\n    }\n}\n\nexport const useBulkGeneratePayroll = () => {\n    const getUrl = useTenantUrl()\n    const loading = ref(false)\n    const error = ref<any>(null)\n    const data = ref<BulkGeneratePayrollResponse | null>(null)\n\n    const mutate = async (payload: BulkGeneratePayrollRequest, options?: { onSuccess?: (data: BulkGeneratePayrollResponse) => void, onError?: (error: any) => void }) => {\n        loading.value = true\n        error.value = null\n        try {\n            const res = await $fetch<BulkGeneratePayrollResponse>(getUrl('/payroll/bulk-generate'), {\n                method: 'POST',\n                body: payload\n            })\n            data.value = res\n            if (options?.onSuccess) options.onSuccess(res)\n        } catch (e) {\n            error.value = e\n            if (options?.onError) options.onError(e)\n            throw e\n        } finally {\n            loading.value = false\n        }\n    }\n\n    return {\n        mutate,\n        loading,\n        data,\n        error\n    }\n}\n\nexport const useDeletePayroll = () => {\n    const getUrl = useTenantUrl()\n    const loading = ref(false)\n\n    const mutate = async (id: string, options?: { onSuccess?: () => void, onError?: (error: any) => void }) => {\n        loading.value = true\n        try {\n            await $fetch(getUrl(`/payroll/${id}`), {\n                method: 'DELETE'\n            })\n            if (options?.onSuccess) options.onSuccess()\n        } catch (error) {\n            if (options?.onError) options.onError(error)\n            throw error\n        } finally {\n            loading.value = false\n        }\n    }\n\n    return {\n        mutate,\n        loading\n    }\n}\n"],"names":[],"mappings":"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"}